<script setup>
import { ref, computed, watch } from 'vue'
import store from '@/store'
import { useRoute, useRouter } from 'vue-router'
import Panel from '@/components/Panel'
const route = useRoute()
const router = useRouter()
const entryPanel = ref()

const onDripBtnClick = async () => {
  try {
    if (!store.state.address) await store.dispatch('connect')
    router.push({ name: 'user', params: { address: store.state.address } })
  } catch (e) {
    console.error(e)
    alert('You must connect a wallet to start dripping funds.')
  }
}

const isIndex = computed(() => route.name === 'create')
const childRoute = ref()
watch(route, (to) => {
  if (to.name === 'create') {
    entryPanel.value.open()
  } else {
    entryPanel.value.close()
    setTimeout(() => childRoute.value.scrollIntoView({ behavior: 'smooth' }), 200)
  }
})
</script>

<template lang="pug">
section.py-72

  panel.mx-auto.transition.duration-200(ref="entryPanel", icon="‚òîÔ∏è", label="Create Drips", :collapsed="!isIndex", :isEditable="false", @open="router.push({name: 'create' })", :class="{'opacity-30 notouch_hover_opacity-100 transition duration-150': !isIndex}")
    template(v-slot:header)
      h1.text-violet-650ff Create Drips

    //- TODO description/text about how some can't be edited later !!!
    //- p Now, set a monthly goal for your project and a minimum monthly amount for subscriptions.
    //- template(v-slot:description)
      p Raise funds by offering member tokens in a community or
      //- | <br>Fields in #[span.text-red-500.font-bold red] you cannot change later!

    //- funding options as tiles
    .flex.flex-wrap.-mx-10.mt-40
      .w-1x2.px-10
        .aspect-w-1.aspect-h-1.relative.rounded-2xl.shadow-md-blue.border.border-transparent.notouch_hover_border-violet-500
          router-link.absolute.overlay.flex.flex-col.group(:to="{name: 'create-drips' }")
            div.flex-1.flex.items-center.justify-center
              div
                div.text-2xl.mb-20 üíß
                .text-xl.font-semibold.mb-16 Drip Monthly
                p.text-violet-600.px-10.leading-tight Stream DAI #[span.font-bold every 30 days]<br>to anyone.
            .pb-20.flex.justify-center.w-full
              .border.border-violet-600.rounded-full.h-40.text-violet-650.px-28.flex.items-center.text-ms.notouch_group-hover_bg-violet-600.notouch_group-hover_text-indigo-900.transition.duration-150 Select

      .w-1x2.px-10
        .aspect-w-1.aspect-h-1.relative.rounded-2xl.shadow-md-blue.border.border-transparent.notouch_hover_border-violet-500
          router-link.absolute.overlay.flex.flex-col.group(:to="{name: 'create-drips' }")
            div.flex-1.flex.items-center.justify-center
              div
                div.text-2xl.mb-20 üí¶
                .text-xl.font-semibold.mb-16 Share your drips
                p.text-violet-600.px-10.leading-tight Share a #[b percent] of your incoming drips with anyone.
            .pb-20.flex.justify-center.w-full
              .border.border-violet-600.rounded-full.h-40.text-violet-650.px-28.flex.items-center.text-ms.notouch_group-hover_bg-violet-600.notouch_group-hover_text-indigo-900.transition.duration-150 Select

      .w-full.px-10.mt-20
        .aspect-w-2.aspect-h-1.relative.rounded-2xl.shadow-md-blue.border.border-transparent.notouch_hover_border-violet-500
          router-link.absolute.overlay.flex.flex-col.group(:to="{name: 'create-community' }")
            div.flex-1.flex.items-center.justify-center
              div
                div.text-2xl.mb-20 ‚ú®
                .text-xl.font-semibold.mb-16 Create a Community
                p.mx-auto.text-violet-600.px-10.leading-tight(style="max-width:23em") Fund your community or project by selling #[span.font-bold member tokens] or offering #[span.font-bold subscriptions], and optionally drip funds to others.
            .pb-20.flex.justify-center.w-full
              .border.border-violet-600.rounded-full.h-40.text-violet-650.px-28.flex.items-center.text-ms.notouch_group-hover_bg-violet-600.notouch_group-hover_text-indigo-900.transition.duration-150 Select

  section.pt-24(ref="childRoute")
    router-view(:key="$route.path")

</template>
